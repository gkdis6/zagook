<?xml version="1.0" encoding="UTF-8" ?> 
 
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.project.contents.ContentsMapper">
	<select id="detail" parameterType="int"
		resultType="com.project.contents.ContentsDTO">
		select contentsno, cateno, pname, price, filename, stock, detail, rdate
		from contents
		where contentsno = #{conentsno}
	</select>

	<update id="updateFile" parameterType="Map">
		update contents
		set
		filename = #{fname}
		where contentsno = #{contentsno}
	</update>
	<select id="total" parameterType="Map" resultType="int">
		select count(*) from contents
		<where>
			<choose>
				<when test="col=='pname'">
					pname like '%'||#{word}||'%'
				</when>
				<when test="col=='price'">
					price like '%'||#{word}||'%'
				</when>
				<when test="col=='cateno'">
					cateno like '%'||#{word}||'%'
				</when>
			</choose>
		</where>
	</select>

	<select id="list" parameterType="Map"
		resultType="com.project.contents.ContentsDTO">
		select contentsno, cateno, pname, price, filename, stock, rdate, r
		from (
		select contentsno, cateno, pname, price, filename, stock, rdate,
		rownum r
		from(
		select contentsno, cateno, pname, price, filename,
		stock, rdate
		from contents
		<where>
			<choose>
				<when test="col=='pname'">
					pname like '%'||#{word}||'%'
				</when>
				<when test="col=='price'">
					price like '%'||#{word}||'%'
				</when>
				<when test="col=='cateno'">
					cateno like '%'||#{word}||'%'
				</when>
			</choose>
		</where>
		order by contentsno desc
		)
        <![CDATA[       
                )where r >= #{sno} and r <= #{eno}
        ]]><!-- 오라클에서는 이렇게 나눠서 해줘야함 -->
	</select>

	<update id="update"
		parameterType="com.project.contents.ContentsDTO">
		update contents
		set pname =#{pname},
		price = #{price},
		detail = #{detail}
		where contentsno =#{contentsno}
	</update>

	<insert id="create"
		parameterType="com.project.contents.ContentsDTO">
		insert into contents(contentsno, cateno, pname, price,
		filename, detail,
		rdate, stock)
		values((select nvl(max(contentsno),0)+1
		from contents),
		#{cateno},#{pname}, #{price}, #{filename}, #{detail},
		sysdate, #{stock})
	</insert>
	<!-- 관리자 패스워드 검사 -->
	<select id="passcheck" resultType="int" parameterType="String">
		SELECT
		COUNT(*)
		FROM member
		WHERE id= 'admin' AND
		passwd=#{passwd}
	</select>
	<!-- 삭제 -->
	<delete id="delete" parameterType="int">
		DELETE FROM contents
		WHERE
		contentsno=#{contentsno}
	</delete>
</mapper>