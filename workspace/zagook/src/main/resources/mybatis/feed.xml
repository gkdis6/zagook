<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.project.feed.FeedMapper">
	<select id="list" parameterType="com.project.feed.FeedDTO"
		resultType="com.project.feed.FeedDTO">
		select * from zagook_contents
		where id in (
            select id2 from zagook_friend 
            where id=#{id} and status=3
            ) 
		and privacy!=3
		and (x_site between 37.5535462 - #{base_distance} and 37.5535462 + #{base_distance})
		and (y_site between 126.964296 - #{base_distance} and 126.964296 + #{base_distance})
	</select>
	<select id="mylist" parameterType="com.project.feed.FeedDTO"
		resultType="com.project.feed.FeedDTO">
		select * from zagook_contents
		where id=#{id}
		and (x_site between 37.5535462 - #{base_distance} and 37.5535462 + #{base_distance})
		and (y_site between 126.964296 - #{base_distance} and 126.964296 + #{base_distance})
	</select>
	<select id="listbytime" parameterType="com.project.feed.FeedDTO"
		resultType="com.project.feed.FeedDTO">
		select * from zagook_contents
		where id in (
            select id2 from zagook_friend 
            where id=#{id} and status=3
            ) 
		and privacy!=3
		and (x_site between 37.5535462 - #{base_distance} and 37.5535462 + #{base_distance})
		and (y_site between 126.964296 - #{base_distance} and 126.964296 + #{base_distance})
		order by rdate desc
	</select>
	<select id="mylistbytime" parameterType="com.project.feed.FeedDTO"
		resultType="com.project.feed.FeedDTO">
		select * from zagook_contents
		where id=#{id}
		and (x_site between 37.5535462 - #{base_distance} and 37.5535462 + #{base_distance})
		and (y_site between 126.964296 - #{base_distance} and 126.964296 + #{base_distance})
		order by rdate desc
	</select>
	<select id="tag" parameterType="int"
		resultType="String">
		select tag from zagook_tag where tag_id
		in (select tag_id from zagook_posttag where contentsno=#{contentsno})
	</select>
	<select id="profile" parameterType="String" resultType="com.project.feed.FeedDTO">
		select mname, fname from zagook_member where id=#{id}
	</select>
	
	<select id="likecheck" parameterType="Map"
		resultType="int">
		select count(*) from zagook_like where id=#{id} and contentsno=#{contentsno}
	</select>
	<select id="likecnt" parameterType="Map"
		resultType="int">
		select count(*) from zagook_like where contentsno=#{contentsno}
	</select>
	<insert id="like" parameterType="Map">	
		insert into zagook_like(contentsno, id, ldate)
		values (#{contentsno},#{id},sysdate)
	</insert>
	<update id="updatelikecnt" parameterType="Map">
		update zagook_contents
		set likecnt=(select count(*) from zagook_like where contentsno=#{contentsno})
		where contentsno = #{contentsno}
	</update>
	<delete id="unlike" parameterType="Map">
		delete from zagook_like
		where contentsno=#{contentsno}
		and id=#{id}
	</delete>
</mapper>